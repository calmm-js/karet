!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react"),require("kefir"),require("infestines")):"function"==typeof define&&define.amd?define(["exports","react","kefir","infestines"],r):r(e.karet=e.karet||{},e.React,e.Kefir,e.I)}(this,function(e,r,n,t){"use strict";function i(e,r,n){if(W(e))return n[r.at++];if(t.isArray(e)){for(var a=e,s=0,l=e.length;s<l;++s){var o=e[s],u=o;W(o)?u=n[r.at++]:t.isArray(o)&&(u=i(o,r,n)),u!==o&&(a===e&&(a=e.slice(0)),a[s]=u)}return a}return e}function a(e,r,n){var t=void 0;for(var i in e){var a=e[i];if(W(a)){if(!t){t={};for(var s in e){if(s===i)break;t[s]=e[s]}}t[i]=n[r.at++]}else t&&(t[i]=a)}return t||e}function s(e,r){var n=e.props,t=null,s=null,l=null;e.at=0;for(var o in n){var u=n[o];g===o?l=i(u,e,r):"$$type"===o?t=n[o]:w===o?(s=s||{},s.ref=W(u)?r[e.at++]:u):W(u)?(s=s||{},s[o]=r[e.at++]):A===o?(s=s||{},s.style=a(u,e,r)||u):(s=s||{},s[o]=u)}return l instanceof Array?$.apply(null,[t,s].concat(l)):l?$(t,s,l):$(t,s)}function l(e,r,n){for(var i=0,a=e.length;i<a;++i){var s=e[i];W(s)?n(r,s):t.isArray(s)&&l(s,r,n)}}function o(e,r,n){for(var i in e){var a=e[i];if(W(a))n(r,a);else if(g===i)t.isArray(a)&&l(a,r,n);else if(A===i)for(var s in a){var o=a[s];W(o)&&n(r,o)}}}function u(e){e.values+=1}function f(e,r){r.offAny(e)}function c(e,r){var n=e.pop();n&&r.offAny(n)}function h(e,r){r.onAny(e)}function v(e,r){var n=function r(n){for(var t=e.handlers,i=0;t[i]!==r;)++i;switch(n.type){case k:var a=n.value,s=e.values;s[i]!==a&&(s[i]=a,e.at&&e.forceUpdate());break;case m:throw n.value;default:t[i]=null;var l=t.length;if(l!==e.values.length)return;for(var o=0;o<l;++o)if(t[o])return;e.handlers=null}};e.handlers.push(n),r.onAny(n)}function d(e,r){for(var n=r.length;e<n;++e){var i=r[e];if(W(i)||t.isArray(i)&&d(0,i))return!0}return!1}function p(e){for(var r in e){var n=e[r];if(W(n))return!0;if(g===r){if(t.isArray(n)&&d(0,n))return!0}else if(A===r)for(var i in n)if(W(n[i]))return!0}return!1}function b(e,r){var n={$$type:e};for(var t in r){var i=r[t];"ref"===t?n[w]=i:U!==t&&(n[t]=i)}return n}function y(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r[0],a=r[1]||t.object0;return(t.isString(i)||a[U])&&(d(2,r)||p(a)?(r[1]=b(i,a),r[0]=x):a[U]&&(r[1]=t.dissocPartialU(U,a)||t.object0)),$.apply(void 0,r)}var k="value",m="error",A="style",g="children",U="karet-lift",w="$$ref",$=r.createElement,S=r.Component,W=function(e){return e instanceof n.Observable},j=t.inherit(function(e){S.call(this,e),this.at=0},S,{componentWillReceiveProps:function(e){this.componentWillUnmount(),this.at=0,this.doSubscribe(e)},componentWillMount:function(){this.at=0,this.doSubscribe(this.props)}}),P=t.inherit(function(e){j.call(this,e),this.callback=this.rendered=null},j,{componentWillUnmount:function(){var e=this.callback;e&&this.props.observable.offAny(e)},doSubscribe:function(e){var r=this,n=e.observable;if(W(n)){var t=function(e){switch(e.type){case k:r.rendered=e.value||null,r.at&&r.forceUpdate();break;case m:throw e.value;case"end":r.callback=null}};this.callback=t,n.onAny(t)}else this.rendered=n||null},render:function(){return this.rendered}}),q=function(e){return $(P,{observable:e})},x=t.inherit(function(e){j.call(this,e),this.values=this,this.handlers=null},j,{componentWillUnmount:function(){var e=this.handlers;e instanceof Function?o(this.props,e,f):e&&o(this.props,e.reverse(),c)},doSubscribe:function(e){var r=this;this.values=0,o(e,this,u);var n=this.values;switch(n){case 0:this.values=t.array0;break;case 1:this.values=this,o(e,this.handlers=function(e){switch(e.type){case k:var n=e.value;r.values!==n&&(r.values=n,r.at&&r.forceUpdate());break;case m:throw e.value;default:r.values=[r.values],r.handlers=null}},h);break;default:this.values=Array(n).fill(this),this.handlers=[],o(e,this,v)}},render:function(){if(this.handlers instanceof Function){var e=this.values;return e===this?null:s(this,[e])}for(var r=this.values,n=0,t=r.length;n<t;++n)if(r[n]===this)return null;return s(this,r)}}),C=t.assocPartialU("createElement",y,r),E=function(e){return function(r){return $(x,b(e,r))}};e.fromKefir=q,e.default=C,e.fromClass=E,Object.defineProperty(e,"__esModule",{value:!0})});
